
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Plant Operation Report</title>
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <script src="~/Scripts/jquery-1.9.1.min.js"></script>
    <style>
         .tbl1 {
        width: 100%;
        border: 1px solid #aaa;
        border-spacing: 0;
    }

        .tbl1 thead tr th {
            font-size: 11px;
            text-align: center;
            border-bottom: 1px solid #aaa;
            border-right: 1px solid #aaa;
        }

            .tbl1 thead tr th:last-child {
                border-right: none;
            }

        .tbl1 tbody tr td {
            text-align: center;
            border-bottom: 1px solid #aaa;
            border-right: 1px solid #aaa;
            font-size: 11px;
        }

            .tbl1 tbody tr td:last-child {
                border-right: none;
            }

    .mybtn {
        border-radius: 0;
        width: 100%;
    }

    td input[type=number], td input[type=date], td input[type=text] {
        width: 100%;
        outline: none;
        border: none;
        text-align: center;
    }
    #total td{
        font-weight: bold;
    }
    body{
        padding:2px 3px;
    }
    </style>
</head>
<body>
    <div class="container-fluid" ng-app="ngApp" ng-controller="ctrl">
        <div class="row">
            <h3 class="text-primary text-center">
                <img src="~/Content/img/logo.jpg" width="140" />
            </h3>
            <h4 class="text-center">MONTH OF @ViewBag.StrDate</h4>
            <p class="text-center"><span>Reported By @Session["username"].ToString()</span></p>
        </div>
        <div class="row">
            <table class="tbl1" id="tt">
                <thead>
                    <tr>
                        <th rowspan="2">Date</th>
                        <th rowspan="2">Primary<br />(Hrs)</th>
                        <th rowspan="2">Secondary<br />(Hrs)</th>
                        <th colspan="6">Aggrecate Type(mm)</th>
                        <th rowspan="2"># of Trucks</th>
                        <th rowspan="2">L<br />1</th>
                        <th rowspan="2">L<br />2</th>
                        <th rowspan="2">L<br />3</th>
                        <th rowspan="2">L<br />4</th>
                        <th rowspan="2">L<br />5</th>
                        <th rowspan="2">L<br />6</th>
                        <th rowspan="2">L<br />7</th>
                        <th rowspan="2">L<br />8</th>
                        <th rowspan="2">L<br />9</th>
                        <th rowspan="2">L<br />10</th>
                        <th rowspan="2">L<br />11</th>
                        <th rowspan="2">L<br />12</th>
                        <th rowspan="2">L<br />13</th>
                        <th colspan="4">Liner charge</th>
                        <th colspan="3">Weather</th>
                        <th rowspan="2">Notes</th>
                    </tr>
                    <tr>
                        <th>12</th>
                        <th>19</th>
                        <th>1x2</th>
                        <th>2x3</th>
                        <th>M-30</th>
                        <th>others</th>
                        <th>CS430</th>
                        <th>CH440</th>
                        <th>St.CJ411</th>
                        <th>Sw.CJ411</th>
                        <th>Sunny</th>
                        <th>Cloudy</th>
                        <th>Rain</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="p in op" opid="{{p.id}}" onclick="rS(this)">
                        <td>{{p.date}}</td>
                        <td>{{p.primary}}</td>
                        <td>{{p.secondary}}</td>
                        <td>{{p.a12}}</td>
                        <td>{{p.a19}}</td>
                        <td>{{p.a1x2}}</td>
                        <td>{{p.a2x3}}</td>
                        <td>{{p.m30}}</td>
                        <td>{{p.other}}</td>
                        <td>{{p.truck}}</td>
                        <td>{{p.l1}}</td>
                        <td>{{p.l2}}</td>
                        <td>{{p.l3}}</td>
                        <td>{{p.l4}}</td>
                        <td>{{p.l5}}</td>
                        <td>{{p.l6}}</td>
                        <td>{{p.l7}}</td>
                        <td>{{p.l8}}</td>
                        <td>{{p.l9}}</td>
                        <td>{{p.l10}}</td>
                        <td>{{p.l11}}</td>
                        <td>{{p.l12}}</td>
                        <td>{{p.l13}}</td>
                        <td>
                            <span ng-if="p.cs430==1"><input type="checkbox" value="1" checked /></span>
                            <span ng-if="p.cs430==0"><input type="checkbox" value="0" /></span>
                        </td>
                        <td>
                            <span ng-if="p.ch440==1"><input type="checkbox" value="1" checked /></span>
                            <span ng-if="p.ch440==0"><input type="checkbox" value="0" /></span>
                        </td>
                        <td>
                            <span ng-if="p.stcj411==1"><input type="checkbox" value="1" checked /></span>
                            <span ng-if="p.stcj411==0"><input type="checkbox" value="0" /></span>
                        </td>
                        <td>
                            <span ng-if="p.swcj411==1"><input type="checkbox" value="1" checked /></span>
                            <span ng-if="p.swcj411==0"><input type="checkbox" value="0" /></span>
                        </td>
                        <td>
                            <span ng-if="p.sunny==true"><input type="checkbox" value="1" checked /></span>
                            <span ng-if="p.sunny==false"><input type="checkbox" value="0" /></span>
                        </td>
                        <td>
                            <span ng-if="p.cloudy==true"><input type="checkbox" value="1" checked /></span>
                            <span ng-if="p.cloudy==false"><input type="checkbox" value="0" /></span>
                        </td>
                        <td>
                            <span ng-if="p.rain==true"><input type="checkbox" value="1" checked /></span>
                            <span ng-if="p.rain==false"><input type="checkbox" value="0" /></span>
                        </td>
                        <td style="width: 63px">{{p.note}}</td>
                    </tr>
                    <tr id="total">
                        <td>Total</td>
                        <td id="t1">00</td>
                        <td id="t2">00</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td id="t3">00</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <iframe id="txtArea1" style="display:none"></iframe>
    <script src="~/Scripts/angular.min.js"></script>
    <script>
        var strdate = '@ViewBag.StrDate';
        var burl = '@Url.Content("~" )';
        var ngApp = angular.module('ngApp', []);
        ngApp.controller('ctrl', function ($scope, $http) {
            $http({
                method: 'POST',
                url: burl + "Operation/Get",
                data: $.param({
                    "date": strdate
                }),
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
            }).success(function (data) {
                $scope.op = data;
                getTotal(strdate);
            });
            // function to find total
            function getTotal(strDate) {
                // insert data
                $http({
                    method: 'POST',
                    url: burl + "Operation/GetTotal",
                    data: $.param({
                        "date": strDate
                    }),
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
                }).success(function (data) {
                    $("#t1").html(data[0].t1);
                    $("#t2").html(data[0].t2);
                    $("#t3").html(data[0].t3);
                });
            }
        });
        $(document).ready(function () {
            var url = location.href;
            if(url.indexOf("excel")>0)
            {
                setTimeout(fnExcelReport, 3000);

            }
            if (url.indexOf("pdf")>0) {
                setTimeout(print, 3000);
            }
        });
        function fnExcelReport() {
            var imgUrl = "http://localhost:50224/Content/img/logo.jpg";
            var tab_text = "<table border='2px'><tr><td colspan='31' style='border:none;height:100px'><img src='" + imgUrl + "' width='180' /></td></tr>";
            tab_text += "<tr><td colspan='31' style='font-weight:bold;text-align:center;font-size:28px'>Plant Operation Report</td></tr>";
            tab_text += "<tr><td colspan='31' style='text-align: center;font-size:15px;'>MONTH OF " + strdate + "</td></tr><tr>";
            var textRange; var j = 0;
            tab = document.getElementById('tt'); // id of table
            for (j = 0 ; j < tab.rows.length ; j++) {
                tab_text = tab_text + tab.rows[j].innerHTML + "</tr>";
                //tab_text=tab_text+"</tr>";
            }

            tab_text = tab_text + "</table>";
           
            tab_text = tab_text.replace(/<A[^>]*>|<\/A>/g, "");//remove if u want links in your table
           // tab_text = tab_text.replace(/<img[^>]*>/gi, ""); // remove if u want images in your table
            tab_text = tab_text.replace(/<input[^>]*>|<\/input>/gi, ""); // reomves input params

            var ua = window.navigator.userAgent;
            var msie = ua.indexOf("MSIE ");

            if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./))      // If Internet Explorer
            {
                txtArea1.document.open("txt/html", "replace");
                txtArea1.document.write(tab_text);
                txtArea1.document.close();
                txtArea1.focus();
                sa = txtArea1.document.execCommand("SaveAs", true, "Say Thanks to Sumit.xls");
            }
            else                 //other browser not tested on IE 11
                sa = window.open('data:application/vnd.ms-excel,' + encodeURIComponent(tab_text));

            return (sa);
        }
    </script>
</body>
</html>
